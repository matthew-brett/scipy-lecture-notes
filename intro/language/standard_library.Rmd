---
jupyter:
  jupytext:
    formats: ipynb,Rmd
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.17.2
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Standard Library

:::{note}
Reference document for this section:

- The Python Standard Library documentation:
  <https://docs.python.org/3/library/index.html>
- Python Essential Reference, David Beazley, Addison-Wesley Professional
:::

## `os` module: operating system functionality

*"A portable way of using operating system dependent functionality."*

### Directory and file manipulation

Current directory:

```{python}
import os
os.getcwd()
```

List a directory:

```{python}
os.listdir(os.curdir)
```

Make a directory:

```{python}
os.mkdir('junkdir')
'junkdir' in os.listdir(os.curdir)
```

Rename the directory:

```{python}
os.rename('junkdir', 'foodir')
'junkdir' in os.listdir(os.curdir)
```

```{python}
'foodir' in os.listdir(os.curdir)
```

```{python}
os.rmdir('foodir')
'foodir' in os.listdir(os.curdir)
```

Delete a file:

```{python}
fp = open('junk.txt', 'w')
fp.close()
'junk.txt' in os.listdir(os.curdir)
```

```{python}
os.remove('junk.txt')
'junk.txt' in os.listdir(os.curdir)
```

### `os.path`: path manipulations

`os.path` provides common operations on pathnames.

```{python}
fp = open('junk.txt', 'w')
fp.close()
a = os.path.abspath('junk.txt')
a
```

```{python}
os.path.split(a)
```

```{python}
os.path.dirname(a)
```

```{python}
os.path.basename(a)
```

```{python}
os.path.splitext(os.path.basename(a))
```

```{python}
os.path.exists('junk.txt')
```

```{python}
os.path.isfile('junk.txt')
```

```{python}
os.path.isdir('junk.txt')
```

```{python}
os.path.expanduser('~/local')
```

```{python}
os.path.join(os.path.expanduser('~'), 'local', 'bin')
```

### Running an external command

```{python}
os.system('ls')
```

:::{note}
Alternative to `os.system`

A noteworthy alternative to `os.system` is the [sh module](https://amoffat.github.com/sh/). Which provides much more convenient ways to
obtain the output, error stream and exit code of the external command.

```python


import sh
com = sh.ls()

print(com)
basic_types.rst   exceptions.rst   oop.rst              standard_library.rst
control_flow.rst  first_steps.rst  python_language.rst
demo2.py          functions.rst    python-logo.png
demo.py           io.rst           reusing_code.rst

type(com)
Out[33]: str
```
:::

### Walking a directory

`os.path.walk` generates a list of filenames in a directory tree.

```{python}
for dirpath, dirnames, filenames in os.walk(os.curdir):
    for fp in filenames:
        print(os.path.abspath(fp))
```

### Environment variables:

```{python}
os.environ.keys()
```

```{python}
os.environ['SHELL']
```

## `shutil`: high-level file operations

The `shutil` provides useful file operations:

> - `shutil.rmtree`: Recursively delete a directory tree.
> - `shutil.move`: Recursively move a file or directory to another location.
> - `shutil.copy`: Copy files or directories.

## `glob`: Pattern matching on files

The `glob` module provides convenient file pattern matching.

Find all files ending in `.txt`:

```{python}
import glob
glob.glob('*.txt')
```

## `sys` module: system-specific information

System-specific information related to the Python interpreter.

- Which version of python are you running and where is it installed:

```{python}
import sys
sys.platform
```

```{python}
sys.version
```

```{python}
sys.prefix
```

- List of command line arguments passed to a Python script:

```{python}
sys.argv
```

`sys.path` is a list of strings that specifies the search path for
modules. Initialized from PYTHONPATH:

```{python}
sys.path
```

## `pickle`: easy persistence

Useful to store arbitrary objects to a file. Not safe or fast!

```{python}
import pickle
l = [1, None, 'Stan']
with open('test.pkl', 'wb') as file:
    pickle.dump(l, file)
```

```{python}
with open('test.pkl', 'rb') as file:
    out = pickle.load(file)
```

```{python}
out
```

:::{admonition} Exercise
Write a program to search your `PYTHONPATH` for the module `site.py`.
:::

{ref}`path_site`
